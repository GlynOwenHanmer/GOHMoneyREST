version: '3.5'
services:
  gohmoneyrestapi:
    container_name: gohmoney-rest
    build:
      context: .
      dockerfile: server.Dockerfile
    image: gohmoney-rest:functional-test
    ports:
    - "8080:8080"
    environment:
      ENV: docker
      PORT: 8080
      DB_HOST: postgres
      DB_USER: functionaltest-dbuser
      DB_NAME: functionaltest-dbname
      DB_SSLMODE: disable
  postgres:
    image: postgres
    restart: always
    ports:
    - "5432:5432"
    environment:
      ENV: docker
      POSTGRES_PASSWORD: ""
      POSTGRES_USER: functionaltest-dbuser
      POSTGRES_DB: functionaltest-dbname
  functional-tests:
    container_name: functional-tests
    image: functional-tests
    build:
      context: .
      dockerfile: tests.Dockerfile
    environment:
      ENV: docker
      DB_HOST: postgres
      DB_USER: functionaltest-dbuser
      DB_NAME: functionaltest-dbname
      DB_SSLMODE: disable