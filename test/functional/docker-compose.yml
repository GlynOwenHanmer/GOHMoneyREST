version: '3.5'
services:
  accountingrestapi:
    container_name: accounting-rest
    build:
      context: .
      dockerfile: server.Dockerfile
    image: accounting-rest:functionaltest
    ports:
    - "8080:8080"
    environment:
      ENV: docker
      PORT: 8080
      DB_HOST: postgres
      DB_USER: postgres
      DB_NAME: functionaltest_dbname
      DB_SSLMODE: disable
  postgres:
    image: postgres
    build:
      context: .
      dockerfile: postgres.Dockerfile
    restart: always
    ports:
    - "5432:5432"
    environment:
      ENV: docker
      POSTGRES_PASSWORD: ""
      POSTGRES_USER: postgres
  functional-tests:
    container_name: functional-tests
    image: functional-tests
    build:
      context: .
      dockerfile: tests.Dockerfile
    environment:
      ENV: docker
      DB_HOST: postgres
      DB_USER: postgres
      DB_NAME: functionaltest_dbname
      DB_SSLMODE: disable